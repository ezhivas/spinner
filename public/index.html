<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpinneR API Client</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        gray: {
                            900: '#1a1b1e',
                            800: '#25262b',
                            700: '#2c2e33',
                            600: '#373a40',
                        }
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/monokai.min.css">
    <style>
        .CodeMirror {
            height: auto;
            min-height: 120px;
            max-height: 400px;
            width: 100% !important;
            border: 1px solid #373a40;
            font-size: 13px;
        }

        .CodeMirror-scroll {
            min-height: 120px;
            max-height: 400px;
            overflow-y: auto !important;
            overflow-x: auto !important;
        }

        .CodeMirror-sizer {
            min-width: 100% !important;
        }

        .CodeMirror-gutters {
            background: #2c2e33;
            border-right: 1px solid #373a40;
            color: #888;
            min-height: 100%;
        }
        .CodeMirror-linenumber {
            color: #888;
            padding: 0 3px 0 5px;
            min-width: 20px;
            text-align: right;
        }
        .CodeMirror-lint-marker-error {
            /* background: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAADCAYAAAC09K7GAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9sJDw4cOCW1/KIAAAAZdEVYdENvbW1lbnQAAAAAAENyZWF0ZWQgd2l0aCBHSU1QZC5lBwAAAFBJREFUCNdj/P//PwOgcAVDDGgYQRhBGMIQxhgGGMYwhjFGMYYxBjGGMYYxBjGGMYYxBjGGMYYxBjGGMYYxBjGGMYYxBjGGMYYxBjGGMYYxBjGGMYYxBjGGMYYxBjGGMYYxBjGGMYYxAAAAABJRU5ErkJggg==') no-repeat center; */
        }

        /* Spinner animation */
        @keyframes spin {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }

        .spinner {
            display: inline-block;
            width: 14px;
            height: 14px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-right: 8px;
            vertical-align: middle;
        }

        /* Toast notifications */
        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }

        .toast {
            animation: slideInRight 0.3s ease-out;
            pointer-events: auto;
            min-width: 300px;
            max-width: 400px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .toast.hiding {
            animation: slideOutRight 0.3s ease-in;
        }

        .toast-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border-left: 4px solid #047857;
        }

        .toast-error {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            border-left: 4px solid #b91c1c;
        }

        .toast-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            border-left: 4px solid #b45309;
        }

        .toast-info {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            border-left: 4px solid #1d4ed8;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 h-screen flex overflow-hidden font-sans">

<!-- Toast Container -->
<div id="toastContainer" class="fixed top-4 right-4 z-[9999] flex flex-col gap-2 pointer-events-none"></div>

<div class="w-1/4 bg-gray-800 border-r border-gray-700 flex flex-col">
    <div class="p-4 border-b border-gray-700 font-bold text-xl flex justify-between items-center">
        <span>üöÄ SpinneR üöÄ</span>
        <span id="modeIndicator" class="text-xs px-2 py-1 rounded bg-gray-700"></span>
        <button id="refreshBtn" class="text-sm bg-gray-700 hover:bg-gray-600 px-2 py-1 rounded">‚Üª</button>
    </div>
    <div class="flex border-b border-gray-700">
        <button id="requestsTab" class="flex-1 py-2 text-center bg-gray-700 text-white font-bold text-xs">Requests</button>
        <button id="collectionRequestsTab" class="flex-1 py-2 text-center bg-gray-600 text-gray-300 hover:bg-gray-700 text-xs">Collection</button>
        <button id="collectionsTab" class="flex-1 py-2 text-center bg-gray-600 text-gray-300 hover:bg-gray-700 text-xs">Collections</button>
        <button id="runsTab" class="flex-1 py-2 text-center bg-gray-600 text-gray-300 hover:bg-gray-700 text-xs">History</button>
    </div>
    <div id="requestsList" class="flex-1 overflow-y-auto p-2 space-y-1">
        <div class="text-center text-gray-500 mt-10">Loading...</div>
    </div>
    <div class="p-2 border-t border-gray-700">
        <button id="newRequestBtn" class="w-full bg-green-600 hover:bg-green-500 text-white py-2 rounded">+ New Request</button>
    </div>
    <div id="collectionsList" class="flex-1 overflow-y-auto p-2 space-y-1 hidden">
        <div class="text-center text-gray-500 mt-10">Loading...</div>
        <button id="newCollectionBtn" class="w-full bg-blue-600 hover:bg-blue-500 text-white py-2 rounded mt-4">+ New Collection</button>
    </div>
    <div id="runsList" class="flex-1 overflow-y-auto p-2 space-y-1 hidden">
        <div class="text-center text-gray-500 mt-10">Loading...</div>
    </div>
    <div id="runsFooter" class="p-2 border-t border-gray-700 hidden">
        <button id="cleanupHistoryBtn" class="w-full bg-red-600 hover:bg-red-500 text-white py-2 rounded text-sm">üóëÔ∏è Clean History</button>
    </div>
</div>

<div class="flex-1 flex flex-col h-full">

    <!-- Header Panel -->
    <div class="p-4 bg-gray-800 border-b border-gray-700 flex justify-between items-center">
        <div class="flex space-x-2">
            <button id="importBtn" class="bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded text-sm">Import Collection</button>
            <button id="exportBtn" class="bg-green-600 hover:bg-green-500 text-white px-4 py-2 rounded text-sm">Export Collection</button>
            <button id="environmentsBtn" class="bg-purple-600 hover:bg-purple-500 text-white px-4 py-2 rounded text-sm">Environments</button>
        </div>
        <div class="flex space-x-2">
            <button id="backupExportBtn" class="bg-orange-600 hover:bg-orange-500 text-white px-4 py-2 rounded text-sm">üíæ Backup</button>
            <button id="backupImportBtn" class="bg-pink-600 hover:bg-pink-500 text-white px-4 py-2 rounded text-sm">üì• Restore</button>
        </div>
        <div class="text-gray-400 text-sm">üöÄSpinneRüöÄ</div>
    </div>

    <div class="p-4 bg-gray-800 border-b border-gray-700">
        <div class="flex items-center space-x-2 mb-2">
            <select id="methodSelect" class="px-3 py-1 bg-gray-700 rounded font-mono font-bold text-sm text-gray-100 cursor-pointer focus:outline-none focus:border-blue-500 border border-transparent">
                <option value="GET">GET</option>
                <option value="POST">POST</option>
                <option value="PUT">PUT</option>
                <option value="DELETE">DELETE</option>
                <option value="PATCH">PATCH</option>
            </select>
            <input type="text" id="urlInput" class="flex-1 bg-gray-900 border border-gray-700 rounded px-3 py-2 text-gray-300 focus:outline-none focus:border-blue-500" placeholder="Select a request...">
            <select id="environmentSelect" class="bg-gray-900 border border-gray-700 rounded px-3 py-2 text-gray-300 focus:outline-none focus:border-blue-500">
                <option value="">No Environment</option>
            </select>
            <button id="saveChangesBtn" class="bg-green-600 hover:bg-green-500 text-white px-4 py-2 rounded font-bold hidden">üíæ Save</button>
            <button id="runBtn" class="bg-blue-600 hover:bg-blue-500 text-white px-6 py-2 rounded font-bold transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                ‚ñ∂ Run
            </button>
        </div>
        <div class="text-xs text-gray-500">
            üí° Use <code class="bg-gray-900 px-1 rounded text-purple-400">{{ VARIABLE_NAME }}</code> to insert environment variables. Edit fields directly and click Save.
        </div>
    </div>

    <div class="flex-1 flex overflow-hidden">

        <div class="p-4 border-r border-gray-700 overflow-y-auto overflow-x-hidden flex-shrink-0" style="flex-basis: 50%; width: 50%; min-width: 0; max-width: 50%;">
            <h3 class="text-gray-400 text-xs font-bold uppercase mb-2">Query Params (JSON)</h3>
            <div class="w-full overflow-hidden" style="max-width: 100%;">
                <textarea id="requestQueryParamsEdit" class="bg-gray-900 p-3 rounded border border-gray-700 text-sm text-blue-400 w-full" placeholder="Enter JSON query params..."></textarea>
            </div>

            <h3 class="text-gray-400 text-xs font-bold uppercase mt-4 mb-2">Request Body</h3>
            <div class="mb-2 w-full overflow-hidden" style="max-width: 100%;">
                <select id="requestBodyTypeEdit" class="w-full bg-gray-900 border border-gray-700 rounded px-3 py-2 text-gray-300 mb-2 text-sm">
                    <option value="json">JSON</option>
                    <option value="form-data">Form-Data</option>
                </select>
                <textarea id="requestBodyEdit" class="bg-gray-900 p-3 rounded border border-gray-700 text-sm text-green-400 min-h-[100px] w-full" placeholder="Enter JSON body..."></textarea>
                <div id="requestFormDataEdit" class="hidden space-y-2">
                    <div id="requestFormDataFields" class="space-y-2 mb-2"></div>
                    <button type="button" id="addRequestFormDataField" class="text-sm bg-gray-700 hover:bg-gray-600 text-white px-3 py-1 rounded">+ Add Field</button>
                </div>
            </div>

            <h3 class="text-gray-400 text-xs font-bold uppercase mt-4 mb-2">Headers (JSON)</h3>
            <div class="w-full overflow-hidden" style="max-width: 100%;">
                <textarea id="requestHeadersEdit" class="bg-gray-900 p-3 rounded border border-gray-700 text-sm text-yellow-400 w-full" placeholder="Enter JSON headers..."></textarea>
            </div>

            <h3 class="text-gray-400 text-xs font-bold uppercase mt-4 mb-2">
                Post-Request Script
                <span class="text-gray-500 text-[10px] font-normal">(JavaScript - runs after response)</span>
            </h3>
            <div class="w-full overflow-hidden" style="max-width: 100%;">
                <textarea id="postRequestScriptEdit" class="bg-gray-900 p-3 rounded border border-gray-700 text-sm text-purple-400 w-full font-mono min-h-[120px]" placeholder="// Example: Save token to environment&#10;const response = pm.response.json();&#10;pm.environment.set('TOKEN', response.token);&#10;&#10;// Available APIs:&#10;// pm.response.json() - response as JSON&#10;// pm.response.status - status code&#10;// pm.environment.set(key, value)&#10;// pm.environment.get(key)"></textarea>
            </div>
        </div>

        <div class="p-4 bg-gray-900 overflow-y-auto flex flex-col flex-shrink-0 overflow-x-hidden" style="flex-basis: 50%; width: 50%; min-width: 0; max-width: 50%;">
            <div class="flex justify-between items-end mb-2">
                <h3 class="text-gray-400 text-xs font-bold uppercase">Response</h3>
                <div id="statusBadge" class="hidden text-xs px-2 py-1 rounded bg-gray-700">Status: <span id="statusValue"></span></div>
                <div id="timer" class="text-xs text-gray-500 font-mono hidden">Time: <span id="timerValue">0ms</span></div>
            </div>

            <div id="responseArea" class="flex-1 bg-gray-800 p-4 rounded border border-gray-700 font-mono text-sm text-gray-300 overflow-auto break-all" style="white-space: pre-wrap; word-break: break-word; max-width: 100%; overflow-wrap: break-word;">
                Select a request and click Run.
            </div>
        </div>
    </div>
</div>

<!-- Modal for creating new request -->
<div id="createRequestModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
    <div class="bg-gray-800 p-6 rounded-lg w-96 max-w-full mx-4 max-h-[80vh] overflow-y-auto">
        <h2 class="text-xl font-bold mb-4">Create New Request</h2>
        <form id="createRequestForm">
            <div class="mb-4">
                <label class="block text-sm font-medium mb-1">Name</label>
                <input type="text" id="newRequestName" class="w-full bg-gray-900 border border-gray-700 rounded px-3 py-2 text-gray-300" required>
            </div>
            <div class="mb-4">
                <label class="block text-sm font-medium mb-1">Method</label>
                <select id="newRequestMethod" class="w-full bg-gray-900 border border-gray-700 rounded px-3 py-2 text-gray-300">
                    <option value="GET">GET</option>
                    <option value="POST">POST</option>
                    <option value="PUT">PUT</option>
                    <option value="DELETE">DELETE</option>
                    <option value="PATCH">PATCH</option>
                </select>
            </div>
            <div class="mb-4">
                <label class="block text-sm font-medium mb-1">URL</label>
                <input type="text" id="newRequestUrl" class="w-full bg-gray-900 border border-gray-700 rounded px-3 py-2 text-gray-300" placeholder="{{ BASE_URL }}/users" required>
            </div>
            <div class="mb-4">
                <label class="block text-sm font-medium mb-1">Query Params (JSON)</label>
                <textarea id="newRequestQueryParams" class="w-full bg-gray-900 border border-gray-700 rounded px-3 py-2 text-gray-300" rows="1" placeholder='{"page": "1", "limit": "10"}'></textarea>
            </div>
            <div class="mb-4">
                <label class="block text-sm font-medium mb-1">Body Type</label>
                <select id="newRequestBodyType" class="w-full bg-gray-900 border border-gray-700 rounded px-3 py-2 text-gray-300">
                    <option value="json">JSON</option>
                    <option value="form-data">Form-Data</option>
                </select>
            </div>
            <div class="mb-4" id="jsonBodyContainer">
                <label class="block text-sm font-medium mb-1">Body (JSON)</label>
                <textarea id="newRequestBody" class="w-full bg-gray-900 border border-gray-700 rounded px-3 py-2 text-gray-300" rows="5" placeholder='{"key": "value"}'></textarea>
            </div>
            <div class="mb-4 hidden" id="formDataContainer">
                <label class="block text-sm font-medium mb-1">Form-Data</label>
                <div id="formDataFields" class="space-y-2 mb-2">
                    <!-- Form-data fields will be added here -->
                </div>
                <button type="button" id="addFormDataField" class="text-sm bg-gray-700 hover:bg-gray-600 text-white px-3 py-1 rounded">+ Add Field</button>
            </div>
            <div class="mb-4">
                <label class="block text-sm font-medium mb-1">Headers (JSON)</label>
                <textarea id="newRequestHeaders" class="w-full bg-gray-900 border border-gray-700 rounded px-3 py-2 text-gray-300" rows="1" placeholder='{"Authorization": "Bearer {{ API_TOKEN }}"}'></textarea>
            </div>
            <div class="mb-4">
                <label class="block text-sm font-medium mb-1">
                    Post-Request Script
                    <span class="text-gray-500 text-xs">(optional - runs after response)</span>
                </label>
                <textarea id="newRequestPostScript" class="w-full bg-gray-900 border border-gray-700 rounded px-3 py-2 text-gray-300 font-mono text-sm" rows="3" placeholder="// Example:&#10;const data = pm.response.json();&#10;pm.environment.set('TOKEN', data.token);"></textarea>
            </div>
            <div class="mb-4">
                <label class="block text-sm font-medium mb-1">Collection</label>
                <select id="newRequestCollection" class="w-full bg-gray-900 border border-gray-700 rounded px-3 py-2 text-gray-300">
                    <option value="">No Collection</option>
                </select>
            </div>
            <div class="flex justify-end space-x-2">
                <button type="button" id="cancelCreateRequest" class="px-4 py-2 bg-gray-600 hover:bg-gray-500 text-white rounded">Cancel</button>
                <button type="submit" class="px-4 py-2 bg-green-600 hover:bg-green-500 text-white rounded">Create</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal for importing collection -->
<div id="importCollectionModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
    <div class="bg-gray-800 p-6 rounded-lg w-96 max-w-full mx-4">
        <h2 class="text-xl font-bold mb-4">Import Collection</h2>
        <form id="importCollectionForm">
            <div class="mb-4">
                <label class="block text-sm font-medium mb-1">Upload Postman Collection JSON File</label>
                <input type="file" id="importFile" accept=".json" class="w-full bg-gray-900 border border-gray-700 rounded px-3 py-2 text-gray-300">
            </div>
            <div class="mb-4">
                <label class="block text-sm font-medium mb-1">Or Paste JSON</label>
                <textarea id="importJson" class="w-full bg-gray-900 border border-gray-700 rounded px-3 py-2 text-gray-300" rows="5" placeholder='Paste Postman collection JSON here...'></textarea>
            </div>
            <div class="flex justify-end space-x-2">
                <button type="button" id="cancelImport" class="px-4 py-2 bg-gray-600 hover:bg-gray-500 text-white rounded">Cancel</button>
                <button type="submit" class="px-4 py-2 bg-green-600 hover:bg-green-500 text-white rounded">Import</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal for exporting collection -->
<div id="exportCollectionModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
    <div class="bg-gray-800 p-6 rounded-lg w-96 max-w-full mx-4">
        <h2 class="text-xl font-bold mb-4">Export Collection</h2>
        <form id="exportCollectionForm">
            <div class="mb-4">
                <label class="block text-sm font-medium mb-1">Select Collection</label>
                <select id="exportCollectionSelect" class="w-full bg-gray-900 border border-gray-700 rounded px-3 py-2 text-gray-300">
                    <option value="">Select a collection...</option>
                </select>
            </div>
            <div class="flex justify-end space-x-2">
                <button type="button" id="cancelExport" class="px-4 py-2 bg-gray-600 hover:bg-gray-500 text-white rounded">Cancel</button>
                <button type="submit" class="px-4 py-2 bg-green-600 hover:bg-green-500 text-white rounded">Export</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal for viewing collection details -->
<div id="viewCollectionModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
    <div class="bg-gray-800 p-6 rounded-lg w-[600px] max-w-full mx-4 max-h-[80vh] overflow-y-auto">
        <h2 class="text-xl font-bold mb-4">Collection: <span id="viewCollectionName" class="text-blue-400"></span></h2>
        <div class="mb-4">
            <div class="flex justify-between items-center mb-2">
                <span class="text-sm font-medium text-gray-400">Requests (<span id="viewCollectionCount">0</span>)</span>
                <button id="closeViewCollection" class="text-gray-400 hover:text-gray-300">‚úï</button>
            </div>
            <div id="viewCollectionRequests" class="space-y-2 max-h-96 overflow-y-auto">
                <!-- Requests will be displayed here -->
            </div>
        </div>
    </div>
</div>

<!-- Modal for viewing run details -->
<div id="viewRunModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
    <div class="bg-gray-800 p-6 rounded-lg w-[700px] max-w-full mx-4 max-h-[80vh] overflow-y-auto">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-bold">Run Details</h2>
            <button id="closeViewRun" class="text-gray-400 hover:text-gray-300 text-xl">‚úï</button>
        </div>

        <!-- Run Info -->
        <div class="mb-4 p-3 bg-gray-900 rounded border border-gray-700">
            <div class="flex items-center justify-between mb-2">
                <span class="text-lg font-medium text-gray-300" id="runDetailName">Request Name</span>
                <span id="runDetailStatus" class="text-xs px-2 py-1 rounded">STATUS</span>
            </div>
            <div class="flex gap-4 text-xs text-gray-400">
                <span id="runDetailTime">Time ago</span>
                <span id="runDetailDuration">Duration</span>
            </div>
        </div>

        <!-- Request Details -->
        <div class="mb-4">
            <h3 class="text-sm font-bold text-gray-400 uppercase mb-2">Request</h3>
            <div class="p-3 bg-gray-900 rounded border border-gray-700">
                <div class="flex items-center gap-2 mb-2">
                    <span id="runDetailMethod" class="px-2 py-1 rounded text-xs font-bold">METHOD</span>
                    <span id="runDetailUrl" class="text-sm text-gray-300 break-all">URL</span>
                </div>
                <div id="runDetailQueryParams" class="mt-2 hidden">
                    <div class="text-xs text-blue-400 font-medium mb-1">Query Params:</div>
                    <pre class="text-xs text-gray-300 bg-gray-800 p-2 rounded overflow-x-auto" id="runDetailQueryParamsContent"></pre>
                </div>
                <div id="runDetailBody" class="mt-2 hidden">
                    <div class="text-xs text-green-400 font-medium mb-1">Body:</div>
                    <pre class="text-xs text-gray-300 bg-gray-800 p-2 rounded overflow-x-auto" id="runDetailBodyContent"></pre>
                </div>
                <div id="runDetailHeaders" class="mt-2 hidden">
                    <div class="text-xs text-yellow-400 font-medium mb-1">Headers:</div>
                    <pre class="text-xs text-gray-300 bg-gray-800 p-2 rounded overflow-x-auto" id="runDetailHeadersContent"></pre>
                </div>
            </div>
        </div>

        <!-- Response Details -->
        <div class="mb-4" id="runDetailResponseSection">
            <h3 class="text-sm font-bold text-gray-400 uppercase mb-2">Response</h3>
            <div class="p-3 bg-gray-900 rounded border border-gray-700">
                <div class="flex items-center gap-2 mb-2">
                    <span class="text-xs text-gray-400">Status:</span>
                    <span id="runDetailResponseStatus" class="text-sm font-medium">-</span>
                </div>
                <div>
                    <div class="text-xs text-gray-400 font-medium mb-1">Body:</div>
                    <pre class="text-xs text-gray-300 bg-gray-800 p-2 rounded overflow-x-auto max-h-64" id="runDetailResponseBody"></pre>
                </div>
            </div>
        </div>

        <!-- Error Details -->
        <div class="mb-4 hidden" id="runDetailErrorSection">
            <h3 class="text-sm font-bold text-red-400 uppercase mb-2">Error</h3>
            <div class="p-3 bg-red-900 bg-opacity-20 rounded border border-red-700">
                <pre class="text-sm text-red-300 whitespace-pre-wrap" id="runDetailError"></pre>
            </div>
        </div>

        <!-- Environment Info -->
        <div id="runDetailEnvironment" class="hidden">
            <h3 class="text-sm font-bold text-gray-400 uppercase mb-2">Environment</h3>
            <div class="p-3 bg-gray-900 rounded border border-gray-700">
                <span class="text-sm text-purple-400" id="runDetailEnvironmentName">-</span>
            </div>
        </div>
    </div>
</div>

<!-- Modal for managing environments -->
<div id="manageEnvironmentsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
    <div class="bg-gray-800 p-6 rounded-lg w-96 max-w-full mx-4 max-h-[80vh] overflow-y-auto">
        <h2 class="text-xl font-bold mb-4">Manage Environments</h2>
        <div id="environmentsList" class="space-y-2 mb-4">
            <div class="text-center text-gray-500">Loading...</div>
        </div>
        <button id="newEnvironmentBtn" class="w-full bg-purple-600 hover:bg-purple-500 text-white py-2 rounded mb-2">+ New Environment</button>
        <div class="flex gap-2 mb-4">
            <button id="importEnvironmentBtn" class="flex-1 bg-blue-600 hover:bg-blue-500 text-white py-2 rounded text-sm">üì• Import</button>
            <button id="exportEnvironmentBtn" class="flex-1 bg-green-600 hover:bg-green-500 text-white py-2 rounded text-sm">üì§ Export</button>
        </div>
        <div class="flex justify-end">
            <button id="closeManageEnvironments" class="px-4 py-2 bg-gray-600 hover:bg-gray-500 text-white rounded">Close</button>
        </div>
    </div>
</div>

<!-- Modal for creating/editing environment -->
<div id="createEnvironmentModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
    <div class="bg-gray-800 p-6 rounded-lg w-96 max-w-full mx-4 max-h-[80vh] overflow-y-auto">
        <h2 id="environmentModalTitle" class="text-xl font-bold mb-4">Create Environment</h2>

        <!-- Info block -->
        <div class="mb-4 p-3 bg-blue-900 bg-opacity-20 border border-blue-700 rounded">
            <div class="text-xs text-blue-300 mb-1">üí° How to use variables:</div>
            <div class="text-xs text-gray-300 font-mono">
                URL: <span class="text-purple-400">{{ BASE_URL }}</span>/users<br>
                Header: "Bearer <span class="text-purple-400">{{ API_TOKEN }}</span>"
            </div>
        </div>

        <form id="createEnvironmentForm">
            <div class="mb-4">
                <label class="block text-sm font-medium mb-1">Name</label>
                <input type="text" id="environmentName" class="w-full bg-gray-900 border border-gray-700 rounded px-3 py-2 text-gray-300" required>
            </div>
            <div class="mb-4">
                <label class="block text-sm font-medium mb-1">Variables</label>
                <div id="environmentVariablesFields" class="space-y-2 mb-2">
                    <!-- Environment variable fields will be added here -->
                </div>
                <button type="button" id="addEnvironmentVariable" class="text-sm bg-gray-700 hover:bg-gray-600 text-white px-3 py-1 rounded">+ Add Variable</button>
            </div>
            <div class="flex justify-end space-x-2">
                <button type="button" id="cancelCreateEnvironment" class="px-4 py-2 bg-gray-600 hover:bg-gray-500 text-white rounded">Cancel</button>
                <button type="submit" class="px-4 py-2 bg-purple-600 hover:bg-purple-500 text-white rounded">Save</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal for viewing environment -->
<div id="viewEnvironmentModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
    <div class="bg-gray-800 p-6 rounded-lg w-96 max-w-full mx-4 max-h-[80vh] overflow-y-auto">
        <h2 class="text-xl font-bold mb-4">View Environment</h2>
        <div class="mb-4">
            <label class="block text-sm font-medium mb-1">Name</label>
            <input type="text" id="viewEnvironmentName" class="w-full bg-gray-900 border border-gray-700 rounded px-3 py-2 text-gray-300" readonly>
        </div>
        <div class="mb-4">
            <label class="block text-sm font-medium mb-1">Variables</label>
            <div id="viewEnvironmentVariables" class="space-y-2 max-h-64 overflow-y-auto">
                <!-- Variables will be displayed here -->
            </div>
        </div>
        <div class="flex justify-end">
            <button id="closeViewEnvironment" class="px-4 py-2 bg-gray-600 hover:bg-gray-500 text-white rounded">Close</button>
        </div>
    </div>
</div>

<!-- Modal for managing environment variables -->
<div id="manageVariablesModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
    <div class="bg-gray-800 p-6 rounded-lg w-96 max-w-full mx-4 max-h-[80vh] overflow-y-auto">
        <h2 class="text-xl font-bold mb-4">Manage Variables: <span id="manageVarEnvName" class="text-purple-400"></span></h2>
        <div class="mb-4">
            <label class="block text-sm font-medium mb-2">Variables</label>
            <div id="manageVariablesList" class="space-y-2 mb-3 max-h-64 overflow-y-auto">
                <!-- Variables will be displayed here -->
            </div>
        </div>
        <div class="mb-4">
            <label class="block text-sm font-medium mb-2">Add New Variable</label>
            <div class="flex gap-2">
                <input type="text" id="newVarKey" placeholder="Key" class="flex-1 bg-gray-900 border border-gray-700 rounded px-3 py-2 text-gray-300 text-sm">
                <input type="text" id="newVarValue" placeholder="Value" class="flex-1 bg-gray-900 border border-gray-700 rounded px-3 py-2 text-gray-300 text-sm">
                <button id="addNewVariable" class="bg-green-600 hover:bg-green-500 text-white px-4 py-2 rounded text-sm">Add</button>
            </div>
        </div>
        <div class="flex justify-end">
            <button id="closeManageVariables" class="px-4 py-2 bg-gray-600 hover:bg-gray-500 text-white rounded">Close</button>
        </div>
    </div>
</div>

<!-- Modal for importing environment -->
<div id="importEnvironmentModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
    <div class="bg-gray-800 p-6 rounded-lg w-[500px] max-w-full mx-4 max-h-[80vh] overflow-y-auto">
        <h2 class="text-xl font-bold mb-4">Import Environment</h2>
        <form id="importEnvironmentForm">
            <div class="mb-4">
                <label class="block text-sm font-medium mb-1">Paste Postman Environment JSON</label>
                <textarea id="importEnvironmentJson" class="w-full bg-gray-900 border border-gray-700 rounded px-3 py-2 text-gray-300" rows="10" placeholder='{"name": "My Environment", "values": [{"key": "BASE_URL", "value": "https://api.example.com", "enabled": true}]}'></textarea>
            </div>
            <div class="flex justify-end space-x-2">
                <button type="button" id="cancelImportEnvironment" class="px-4 py-2 bg-gray-600 hover:bg-gray-500 text-white rounded">Cancel</button>
                <button type="submit" class="px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded">Import</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal for exporting environment -->
<div id="exportEnvironmentModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
    <div class="bg-gray-800 p-6 rounded-lg w-96 max-w-full mx-4">
        <h2 class="text-xl font-bold mb-4">Export Environment</h2>
        <form id="exportEnvironmentForm">
            <div class="mb-4">
                <label class="block text-sm font-medium mb-1">Select Environment</label>
                <select id="exportEnvironmentSelect" class="w-full bg-gray-900 border border-gray-700 rounded px-3 py-2 text-gray-300">
                    <option value="">Select an environment...</option>
                </select>
            </div>
            <div class="flex justify-end space-x-2">
                <button type="button" id="cancelExportEnvironment" class="px-4 py-2 bg-gray-600 hover:bg-gray-500 text-white rounded">Cancel</button>
                <button type="submit" class="px-4 py-2 bg-green-600 hover:bg-green-500 text-white rounded">Export</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal for cleanup history -->
<div id="cleanupHistoryModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
    <div class="bg-gray-800 p-6 rounded-lg w-96 max-w-full mx-4">
        <h2 class="text-xl font-bold mb-4">Clean History</h2>
        <p class="text-sm text-gray-400 mb-4">Delete all runs older than specified hours. Keep only recent history.</p>

        <form id="cleanupHistoryForm">
            <div class="mb-4">
                <label class="block text-sm font-medium mb-2">Keep last (hours)</label>
                <div class="grid grid-cols-4 gap-2 mb-3">
                    <button type="button" class="cleanup-hours-btn bg-gray-700 hover:bg-gray-600 text-white py-2 rounded text-sm" data-hours="0.5">0.5h</button>
                    <button type="button" class="cleanup-hours-btn bg-gray-700 hover:bg-gray-600 text-white py-2 rounded text-sm" data-hours="1">1h</button>
                    <button type="button" class="cleanup-hours-btn bg-gray-700 hover:bg-gray-600 text-white py-2 rounded text-sm" data-hours="2">2h</button>
                    <button type="button" class="cleanup-hours-btn bg-gray-700 hover:bg-gray-600 text-white py-2 rounded text-sm" data-hours="6">6h</button>
                    <button type="button" class="cleanup-hours-btn bg-gray-700 hover:bg-gray-600 text-white py-2 rounded text-sm" data-hours="12">12h</button>
                    <button type="button" class="cleanup-hours-btn bg-gray-700 hover:bg-gray-600 text-white py-2 rounded text-sm" data-hours="24">24h</button>
                    <button type="button" class="cleanup-hours-btn bg-gray-700 hover:bg-gray-600 text-white py-2 rounded text-sm" data-hours="48">48h</button>
                    <button type="button" class="cleanup-hours-btn bg-gray-700 hover:bg-gray-600 text-white py-2 rounded text-sm" data-hours="168">1w</button>
                </div>
                <label class="block text-sm font-medium mb-1">Or enter custom:</label>
                <input type="number" id="cleanupHoursInput" step="0.5" min="0.5" class="w-full bg-gray-900 border border-gray-700 rounded px-3 py-2 text-gray-300" placeholder="e.g. 3.5">
            </div>

            <div class="bg-yellow-900 bg-opacity-20 border border-yellow-700 rounded p-3 mb-4">
                <div class="text-xs text-yellow-300">‚ö†Ô∏è Warning: This action cannot be undone!</div>
            </div>

            <div class="flex justify-end space-x-2">
                <button type="button" id="cancelCleanupHistory" class="px-4 py-2 bg-gray-600 hover:bg-gray-500 text-white rounded">Cancel</button>
                <button type="submit" class="px-4 py-2 bg-red-600 hover:bg-red-500 text-white rounded">üóëÔ∏è Clean</button>
            </div>
        </form>
    </div>
</div>

<!-- Backup Import Modal -->
<div id="backupImportModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
    <div class="bg-gray-800 p-6 rounded-lg w-2/3 max-w-4xl mx-4 border border-gray-700">
        <h2 class="text-xl font-bold mb-4 text-white">üì• Restore Full Backup</h2>

        <div class="bg-yellow-900 bg-opacity-20 border border-yellow-700 rounded p-4 mb-4">
            <p class="text-yellow-300 text-sm font-bold">‚ö†Ô∏è WARNING</p>
            <p class="text-yellow-200 text-xs mt-2">
                This will import ALL data from the backup file (Collections, Requests, Environments, History).
                <br>Existing data will NOT be deleted, but duplicates may be created.
            </p>
        </div>

        <form id="backupImportForm">
            <div class="mb-4">
                <label class="block text-sm font-medium mb-2">Upload Backup File (.json)</label>
                <input type="file" id="backupFileInput" accept=".json" class="w-full bg-gray-900 border border-gray-700 rounded px-3 py-2 text-gray-300">
            </div>

            <div class="mb-4">
                <label class="block text-sm font-medium mb-2">Or Paste Backup JSON</label>
                <textarea id="backupJsonInput" rows="10" class="w-full bg-gray-900 border border-gray-700 rounded px-3 py-2 text-gray-300 font-mono text-xs" placeholder='{"version":"1.0","data":{...}}'></textarea>
            </div>

            <div id="backupImportResult" class="mb-4 hidden">
                <div class="bg-gray-900 border border-gray-700 rounded p-3">
                    <p class="text-sm font-bold text-green-400 mb-2">‚úÖ Import Summary:</p>
                    <div class="text-xs text-gray-300 space-y-1">
                        <div>Collections: <span id="importedCollections" class="text-green-400">0</span></div>
                        <div>Requests: <span id="importedRequests" class="text-green-400">0</span></div>
                        <div>Environments: <span id="importedEnvironments" class="text-green-400">0</span></div>
                        <div>Runs: <span id="importedRuns" class="text-green-400">0</span></div>
                    </div>
                    <div id="importErrors" class="mt-2 hidden">
                        <p class="text-red-400 font-bold text-xs">Errors:</p>
                        <ul id="importErrorsList" class="text-xs text-red-300 list-disc list-inside mt-1"></ul>
                    </div>
                </div>
            </div>

            <div class="flex justify-end space-x-2">
                <button type="button" id="cancelBackupImport" class="px-4 py-2 bg-gray-600 hover:bg-gray-500 text-white rounded">Cancel</button>
                <button type="submit" class="px-4 py-2 bg-pink-600 hover:bg-pink-500 text-white rounded">üì• Restore</button>
            </div>
        </form>
    </div>
</div>

<!-- Confirmation Modal -->
<div id="confirmModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-[10000]">
    <div class="bg-gray-800 p-6 rounded-lg w-96 max-w-full mx-4 border border-gray-700">
        <h2 class="text-xl font-bold mb-3 text-white" id="confirmTitle">Confirm Action</h2>
        <p class="text-gray-300 mb-6" id="confirmMessage">Are you sure?</p>
        <div class="flex justify-end space-x-2">
            <button id="confirmCancel" class="px-4 py-2 bg-gray-600 hover:bg-gray-500 text-white rounded">Cancel</button>
            <button id="confirmOk" class="px-4 py-2 bg-red-600 hover:bg-red-500 text-white rounded">Confirm</button>
        </div>
    </div>
</div>

<!-- Prompt Modal -->
<div id="promptModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-[10000]">
    <div class="bg-gray-800 p-6 rounded-lg w-96 max-w-full mx-4 border border-gray-700">
        <h2 class="text-xl font-bold mb-3 text-white" id="promptTitle">Enter Value</h2>
        <p class="text-gray-400 text-sm mb-3" id="promptMessage"></p>
        <input type="text" id="promptInput" class="w-full bg-gray-900 border border-gray-700 rounded px-3 py-2 text-gray-300 mb-4 focus:outline-none focus:border-blue-500" placeholder="">
        <div class="flex justify-end space-x-2">
            <button id="promptCancel" class="px-4 py-2 bg-gray-600 hover:bg-gray-500 text-white rounded">Cancel</button>
            <button id="promptOk" class="px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded">OK</button>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jsonlint/1.6.0/jsonlint.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/lint/lint.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/lint/json-lint.min.js"></script>
<script src="https://unpkg.com/json5@2/dist/index.min.js"></script>
<script src="app.js"></script>
</body>
</html>



